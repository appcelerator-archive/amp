sudo: required

services:
  - docker

language: go

go:
  - 1.8.x

install:
  - sudo sysctl -w vm.max_map_count=262144
  - go get -u github.com/golang/lint/golint
  - sudo apt update
  - sudo apt install docker-engine
  - make fmt check
  - mkdir -p $HOME/.config/amp && echo SendGridKey:$SENDGRIDKEY >$HOME/.config/amp/amplifier.yaml
  - hack/amptools make -f Makefile.refactor.make cleanall build build-cli-wrapper
  - export PATH=$PWD/bin/linux/amd64:$PATH

script:
  - docker tag appcelerator/amplifier:local localhost:5000/appcelerator/amplifier:local
  - tests/refactored-tests.sh

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
      echo "Docker image publication has been disabled for now";
    fi
